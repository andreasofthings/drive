(()=>{var b="https://apis.google.com/js/api.js",w="https://accounts.google.com/gsi/client";async function k(e="client:picker"){return window.gapi||await u(b),await new Promise(t=>{window.gapi.load(e,t)}),window.google}async function v(e){return window.google?.accounts?.oauth2||await u(w),new Promise((t,i)=>{window.google.accounts.oauth2.initTokenClient({...e,callback:t,error_callback:i}).requestAccessToken()})}async function u(e){return new Promise((t,i)=>{document.querySelector(`script[src="${e}"]`)?t():document.head.appendChild(Object.assign(document.createElement("script"),{src:e,onload:t,onerror:i}))})}function d(e,t){let i=e.getAttribute(t);return i?Number(i):null}var o=(e=>(e[e.FALSE=0]="FALSE",e[e.TRUE=1]="TRUE",e[e.DEFAULT=2]="DEFAULT",e))(o||{});function c(e,t){return e.hasAttribute(t)}function m(e,t){let i=e.getAttribute(t)?.toUpperCase();if(!i)return 2;let r=o[i];if(r!==void 0)return r;throw new Error(`Invalid value, "${i}", for attribute ${t}. Must be one of ${Object.keys(o).filter(Number.isNaN).join(", ")}`)}function n(e,t,i,r){let s=m(t,e);return s===2?r:i.call(r,s===1)}var E=class extends HTMLElement{static get observedAttributes(){return["app-id","client-id","debounce-delay","developer-key","hide-title-bar","locale","max-items","mine-only","multiselect","nav-hidden","oauth-token","origin","relay-url","scope","title"]}picker;observer;google;loading;debounceTimer;get visible(){return!!this.picker?.isVisible()}set visible(e){this.picker?.setVisible(e)}get tokenClientConfig(){let e=this.getAttribute("client-id"),t=this.getAttribute("scope")??"https://www.googleapis.com/auth/drive.file";if(!e||!t)throw new Error("client-id and scope are required attributes");return{client_id:e,hd:this.getAttribute("hd")??void 0,include_granted_scopes:!!this.getAttribute("include-granted-scope"),login_hint:this.getAttribute("login-hint")??void 0,prompt:this.getAttribute("prompt")??"",scope:t}}attributeChangedCallback(){this.scheduleBuild()}scheduleBuild(){clearTimeout(this.debounceTimer),this.debounceTimer=window.setTimeout(()=>{this.build()},d(this,"debounce-delay")??0)}async build(){if(this.picker?.dispose(),await this.loading,!this.google)return;let e=new this.google.picker.PickerBuilder().setCallback(a=>{this.callbackToDispatchEvent(a)}),t=this.getAttribute("app-id");t!==null&&(e=e.setAppId(t));let i=this.getAttribute("developer-key");i!==null&&(e=e.setDeveloperKey(i));let r=this.getAttribute("locale");r!==null&&(e=e.setLocale(r));let s=d(this,"max-items");s!==null&&(e=e.setMaxItems(s));let l=this.getAttribute("origin");l!==null&&(e=e.setOrigin(l));let h=this.getAttribute("relay-url");h!==null&&(e=e.setRelayUrl(h));let p=this.getAttribute("title");p!==null&&(e=e.setTitle(p)),n("hide-title-bar",this,e.hideTitleBar,e);let g=this.getAttribute("oauth-token")??await this.requestAccessToken();if(g){e=e.setOAuthToken(g),c(this,"multiselect")&&(e=e.enableFeature(this.google.picker.Feature.MULTISELECT_ENABLED)),c(this,"mine-only")&&(e=e.enableFeature(this.google.picker.Feature.MINE_ONLY)),c(this,"nav-hidden")&&(e=e.enableFeature(this.google.picker.Feature.NAV_HIDDEN));for(let a of this.views)e=e.addView(a);this.picker=e.build(),this.picker.setVisible(!0)}}get views(){let e=y(this);return e.length?e:["all"]}async connectedCallback(){this.loading=k().then(e=>{this.google=e}),this.observer=new MutationObserver(e=>{e.filter(t=>t.type==="childList"||t.type==="attributes"&&t.target!==this).length&&this.scheduleBuild()}),this.observer?.observe(this,{childList:!0,subtree:!0,attributes:!0})}callbackToDispatchEvent(e){let t;switch(e.action){case google.picker.Action.CANCEL:t=["picker:canceled","picker-canceled"];break;case google.picker.Action.PICKED:t=["picker:picked","picker-picked"];break;case google.picker.Action.ERROR:t=["picker:error","picker-error"];break;default:return}for(let i of t)this.dispatchEvent(new CustomEvent(i,{detail:e}))}async requestAccessToken(){return v(this.tokenClientConfig).then(e=>{let{access_token:t}=e;if(!t){this.dispatchEvent(new CustomEvent("picker:oauth:error",{detail:e})),this.dispatchEvent(new CustomEvent("picker-oauth-error",{detail:e}));return}return this.dispatchEvent(new CustomEvent("picker:authenticated",{detail:{token:t}})),this.dispatchEvent(new CustomEvent("picker-oauth-response",{detail:e})),this.dispatchEvent(new CustomEvent("picker:oauth:response",{detail:e})),this.dispatchEvent(new CustomEvent("picker-oauth-response",{detail:e})),t}).catch(e=>{this.dispatchEvent(new CustomEvent("picker:oauth:error",{detail:e})),this.dispatchEvent(new CustomEvent("picker-oauth-error",{detail:e}))})}disconnectedCallback(){this.picker?.dispose()}};function A(e){return"view"in e&&e.view instanceof window.google.picker.View}function f(e){return e.filter(t=>A(t)).map(t=>t.view)}function y(e,t="*"){return f(Array.from(e.querySelectorAll(t)))}var C=class extends HTMLElement{static get observedAttributes(){return["enable-drives","file-ids","include-folders","mime-types","mode","owned-by-me","parent","query","select-folder-enabled","starred","view-id"]}get view(){let e=new window.google.picker.DocsView(this.viewId);n("enable-drives",this,e.setEnableDrives,e),n("include-folders",this,e.setIncludeFolders,e),n("owned-by-me",this,e.setOwnedByMe,e),n("select-folder-enabled",this,e.setSelectFolderEnabled,e),n("starred",this,e.setStarred,e);let t=this.getAttribute("mime-types");t!==null&&e.setMimeTypes(t);let i=this.getAttribute("file-ids");i!==null&&e.setFileIds(i);let r=this.getAttribute("mode");r&&e.setMode(google.picker.DocsViewMode[r]);let s=this.getAttribute("parent");s!==null&&e.setParent(s);let l=this.getAttribute("query");return l!==null&&e.setQuery(l),e}get viewId(){let e=this.getAttribute("view-id");return e?window.google.picker.ViewId[e]:void 0}};customElements.define("drive-picker",E),customElements.define("drive-picker-docs-view",C)})();
